# システムアーキテクチャ

## 概要

技術情報を自動収集し、AIで分類・要約してSlackなどに配信するシステム。

## 全体構成図

```
┌─────────────────────────────────────────────────────────────────┐
│                        n8n Workflows                            │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  【Read RSS WF】              【Process Articles WF】            │
│  Schedule: 1時間ごと          (サブワークフロー)                  │
│                                                                 │
│  ┌──────────────┐            ┌──────────────────┐              │
│  │Schedule      │            │Execute WF Trigger│              │
│  │Trigger       │            └────────┬─────────┘              │
│  └──────┬───────┘                     │                        │
│         ▼                             ▼                        │
│  ┌──────────────┐            ┌──────────────────┐              │
│  │Get Feed      │            │Format Input      │              │
│  │Sources       │            │(データ正規化)     │              │
│  └──────┬───────┘            └────────┬─────────┘              │
│         ▼                             ▼                        │
│  ┌──────────────┐            ┌──────────────────┐              │
│  │Loop Feeds    │            │Check Duplicate   │              │
│  └──────┬───────┘            │(重複チェック)     │              │
│         ▼                    └────────┬─────────┘              │
│  ┌──────────────┐                     ▼                        │
│  │Read RSS      │            ┌──────────────────┐              │
│  └──────┬───────┘            │AI Process        │              │
│         ▼                    │(GPT-5.1)         │              │
│  ┌──────────────┐            │・カテゴリ判定     │              │
│  │Process       │──────────► │・キーワード抽出   │              │
│  │Articles      │            │・要約生成        │              │
│  │(サブWF呼出)   │            │・タイトル翻訳    │              │
│  └──────┬───────┘            └────────┬─────────┘              │
│         ▼                             ▼                        │
│  ┌──────────────┐            ┌──────────────────┐              │
│  │Slack通知     │            │Save Article      │              │
│  │(完了通知)    │            │(Supabase保存)    │              │
│  └──────────────┘            └──────────────────┘              │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
                             │
                             ▼
┌─────────────────────────────────────────────────────────────────┐
│                      Supabase (PostgreSQL)                      │
├─────────────────────────────────────────────────────────────────┤
│  feed_sources / articles                                        │
└─────────────────────────────────────────────────────────────────┘
```

## コンポーネント

### n8n Workflows

#### Tech News Collector - Read RSS（メインワークフロー）
- **ワークフローID**: `Haf7eC6SXFeqyX0K`
- **実行間隔**: 1時間ごと
- **ステータス**: アクティブ
- **処理内容**:
  1. DBからアクティブなRSSフィードソースを取得
  2. 各フィードをループで処理
  3. RSS取得・パース
  4. サブワークフロー（Process Articles）を呼び出し
  5. 完了後Slackに通知

#### Tech News Collector - Process Articles（サブワークフロー）
- **ワークフローID**: `8M3Ib9Rx0kcznelb`
- **呼び出し元**: Read RSS
- **ステータス**: 非アクティブ（サブワークフローのため）
- **処理内容**:
  1. 記事データを正規化（Format Input）
  2. 重複チェック（guidベース）
  3. GPT-5.1でカテゴリ判定・キーワード抽出・要約・タイトル翻訳
  4. Supabaseに保存

### Supabase
- **用途**: データベース（PostgreSQL）
- **リージョン**: ap-northeast-1（東京）
- **プロジェクト名**: tech-news-collector
- **プロジェクトID**: `vpcpxosutscbjmwvbchi`

### AI (OpenAI GPT-5.1)
- **用途**:
  - カテゴリ自動分類（12種類）
  - キーワード抽出（3〜5個）
  - 記事要約（日本語、200〜300字）
  - 英語記事のタイトル翻訳

## 配信先

| 配信先 | 優先度 | 状態 |
|--------|--------|------|
| Slack | 高 | ✅ 実装済み（完了通知） |
| Discord | 中 | 将来対応 |
| Webサイト | 低 | 将来対応 |

## 設計上の重要な決定事項

1. **サブワークフロー分離**: Split In Batchesのネスト問題を回避するため、記事処理をサブワークフローに分離
2. **重複チェック**: guidベースで重複を判定
3. **タイトル翻訳**: 英語記事は日本語に翻訳し、元のタイトルはoriginal_titleに保存
4. **要約ルール**: 200〜300字、ですます調、メタ表現禁止
